// Haiku data and functions
const haiku = [
    {
        text: "in pine shade\nfor a while I forget\nthis life will end",
        author: "Robert Epstein"
    },
    {
        text: "in pine shade\nfor a while I forget\nthis life will end",
        author: "Robert Epstein"
    },
    {
        text: "some babble\nworth listening to—\nmountain brook",
        author: "Terri L. French"
    },
    {
        text: "mountain sunset\na bit of the day left\nin warm stones",
        author: "Terri L. French"
    },
    {
        text: "autumn clothesline\nthe same old innerwear\ntaking turns",
        author: "Lakshmi Iyer"
    },
    {
        text: "peach orchard\nbarrels filled\nwith sunset",
        author: "Susan Burch"
    },  
    {
        text: "the weight\nof a growing shadow\ncemetery walk",
        author: "Ravi Kiran"
    },  
    {
        text: "between the clouds\nand the mist\nmountain pines",
        author: "Ravi Kiran"
    },  
    {
        text: "sound of rain\nnot everything\nneeds to be understood",
        author: "Ravi Kiran"
    },  
    {
        text: "in spite\nof Manhattan\n Central Park",
        author: "Ravi Kiran"
    },  
    {
        text: "redwood time\nthe steady journey\nfrom earth to sky",
        author: "Annette Makino"
    },  
    {
        text: "October sun\nthe sky the color\nof forever",
        author: "Annette Makino"
    },  
    {
        text: "what remains \n of the mountain\nsand between my toes",
        author: "Annette Makino"
    },  
    {
        text: "edge of the woods \nsome things I may not\n want to know",
        author: "Annette Makino"
    },  
    {
        text: "plain brown bulb \n the mystery\n of becoming",
        author: "Annette Makino"
    },  
    {
        text: "to accept things\nI cannot change \n outgoing tide",
        author: "Annette Makino"
    },  
    {
        text: "to ride bikes\n smiles sun wind road\nwishes of forever",
        author: "Luke Hollomon"
    },  
    {
        text: "mountain sky river\nall run on\never full, ever wild",
        author: "Luke Hollomon"
    },  
    {
        text: "dry wine sweet kisses\nfading light\nlonging",
        author: "Luke Hollomon"
    },  
    {
        text: "breeze through the oaks\nsome things\nstill right with the world",
        author: "Susan Yavaniski"
    },  
    {
        text: "evening swallows\nyour eyes and mine\nin tandem",
        author: "Susan Yavaniski"
    },  
    {
        text: "the water comes\non and on\nsomehow forever",
        author: "Luke Hollomon"
    },  
    {
        text: "deep calm\na herd of black angus\nin the shade",
        author: "Shawn Blair"
    },  
    {
        text: "poison beauty\ncurses its burn\n rhododendron",
        author: "Luke Hollomon"
    },  
    {
        text: "summer night\ncicada chirps\nsweat on your dress",
        author: "Luke Hollomon"
    },  
    {
        text: "tired feet\nhot fire burning\nmoonlight kisses",
        author: "Luke Hollomon"
    },  
    {
        text: "days in the saddle\nspinning spinning spinning\ntranscendence",
        author: "Luke Hollomon"
    },
    {
        text: "love between us is\nspeech and breath. loving you is\na long river running",
        author: "Luke Hollomon"
    },
    {
        text: "lunch alone\nwithout a book\nI read my mind",
        author: "Tom Clausen"
    }, 
    {
        text: "dandelion globe\nI have one last go\nat my kind of world",
        author: "Elmedin Kadric"
    },        
    {
        text: "spring wind\nmoves everything\neven me",
        author: "Tom Clausen"
    },      
    {
        text: "the moon\nhas found it for me\na mountain path",
        author: "Michael McClintock"
    },    
    {
        text: "midnight sun\na polar bear's breath\ncatches fire",
        author: "Unknown"
    },    
    {
        text: "morning dew\nno hiding the way\nwe've come",
        author: "Jim Kacian"
    },    
    {
        text: "before me\nafter me\nredwood",
        author: "Luke Hollomon"
    },    
    {
        text: "sweaty palms\nicy road\nyou sip whiskey",
        author: "Luke Hollomon"
    },    
    {
        text: "peonies bloom and fade\nspring blink gone\nsummer looming",
        author: "Luke Hollomon"
    },    
    {
        text: "puzzles on the couch\nsips of wine\noneness",
        author: "Luke Hollomon"
    },    
    {
        text: "hills rising\nfrom opposite shores\nthe river's grace",
        author: "Mike Montreuil"
    }, 
    {
        text: "being there\nin the woods to see\nthe tree fall",
        author: "Tom Clausen"
    },      
    {
        text: "driftwood bonfire\nwe pretend\nwe're the last humans",
        author: "Kristen Lindquist"
    },   
    {
        text: "zip brrr\na cute nose peeks\nfrom your sleeping bag",
        author: "Luke Hollomon"
    },  
    {
        text: "crumbs disappear\nona park bench\nant by ant",
        author: "Sandi Pray"
    },  
    {
        text: "purple asters\nthe long shadows\nof autumn",
        author: "Michele L. Harvey"
    }, 
    {
        text: "misty haze\nthe distant owl\nsounds near",
        author: "Neena Singh"
    }, 
    {
        text: "winter hills\nwith each boot crunch\nthe scent of sage",
        author: "Mary Jo Balistreri"
    },
    {
        text: "wild strawberries …\nthe skim and dart\nof white butterflies",
        author: "Mary Jo Balistreri"
    },
    {
        text: "breeze in the trees\nplaying with shadows\non the path",
        author: "Tom Clausen"
    },
    {
        text: "on the wharf\nI hang over the edge\nof summer",
        author: "Sharon Ferrante"
    },
    {
        text: "slow dusk\none cricket\nsupplies the pulse",
        author: "Elmedin Kadri"
    },
    {
        text: "blue skies—\nfinding the nowhere\nI'd rather be",
        author: "Matthew Markworth"
    },
    {
        text: "spring equinox\na canoe flipped\nupside up",
        author: "Matthew Markwort"
    },
    {
        text: "milkweed husks\nthe dusk greens\nwith dragonflies",
        author: "Joshua Gage"
    },
    {
        text: "autumn pond . . .\nspending just-us time\nwith my thoughts",
        author: "Scott Mason"
    },
    {
        text: "September twilight—\na honeybee's slow descent\ninto goldenrod",
        author: "Julie Bloss Kelsey"
    },
    {
        text: "a year at most . . .\nwe pretend to watch\nthe hummingbirds",
        author: "Tom Bierovic"
    },
    {
        text: "open meadow\na monarch hinges\non a milkweed",
        author: "Brad Bennett"
    },
    {
        text: "blossom to blossom\na bee tips the fate\nof the world",
        author: "June Rose Dowis"
    },
    {
        text: "to lead a life\nof such purpose . . .\nants in a line",
        author: "Annette Makino"
    },
    {
        text: "light\nfor their world\n     fireflies",
        author: "Gary Hotham"
    },
    {
        text: "paddling through stars\nthe wake of a boat\nlong passed",
        author: "Julie Warther"
    },
    {
        text: "sand dunes\nby morning\na different dream",
        author: "Renée Owen"
    },
    {
        text: "forest clearing\n     a scapula\nleft for the moon",
        author: "Scott Mason"
    },
    {
        text: "heartwood\nthe saw changes\nits tune",
        author: "Michele L. Harvey"
    },
    {
        text: "flowing estuary\nnative languages\nlong gone",
        author: "Mike Blottenberger"
    },
    {
        text: "the big dipper\nno matter where I stand\nmountain sky",
        author: "Michelle Schaefer"
    },
    {
        text: "end of the walk\nreturning the crow's feather\nwhere I found it",
        author: "Margaret Chula"
    },
    {
        text: "trail's end—\nmy pebble\nsettles the cairn",
        author: "Linda Jeannette Ward"
    },
    {
        text: "a jar of pennies\non the lemonade stand\nevening cool",
        author: "Roland Packer"
    },
    {
        text: "lightning . . .\nthe scarecrow's coat sleeve\ncaught in mid-wave",
        author: "Ken Hurm"
    },
    {
        text: "summer's end\nthe hammock turned in\non itself",
        author: "Marjorie Buettner"
    },
    {
        text: "having no thought\nwe've come to see them—\ndogwoods in bloom",
        author: "Michael McClintock"
    },
    {
        text: "turning tide—\nplacing intact clams\nback in the water",
        author: "C. R. Manley"
    },
    {
        text: "mallard pair\nhe rocks\non her wake",
        author: "Alice Frampton"
    },
    {
        text: "filtering in\nwith the night air\na skunk's warning",
        author: "Lois J. Funk"
    },
    {
        text: "stone in my pocket—\nthe brook cuts deeper\ninto the mountain",
        author: "Merrill Ann Gonzales"
    },
    {
        text: "a bee chose\nthe rose I meant to pluck . . .\nempty vase",
        author: "Joan M. Murphy"
    },
    {
        text: "shivering on the roof\nI rub my palms together\nmeteor shower",
        author: "Michael Fessler"
    },
    {
        text: "ocean breeze—\na strand of seaweed\nsteadies the kite",
        author: "John Thompson"
    },
    {
        text: "autumn rose—\neven as I sketch the wind\nmore petals fall",
        author: "Ross Figgins"
    },
    {
        text: "Humid July—\nfrom the stove the smell\nof old fires",
        author: "Doug Hunt"
    },
    {
        text: "meteor shower—\na gentle wave\nwets our sandals",
        author: "Michael Dylan Welch"
    },
    {
        text: "mountain hike\nwe drink from the beginning\nof a great river",
        author: "Yvonne Hardenbrook"
    },
    {
        text: "spring sun—\nhigh in his arms\nthe newborn is shown",
        author: "Tom Clausen"
    },
    {
        text: "snail—\nto know\nits heart beats too",
        author: "Marian Olson"
    },
    {
        text: "I'm caught in it too—\nthe blossom-loosening wind",
        author: "June Moreau"
    },
    {
        text: "Over the railroad tracks\nthe slow motion\nof a snake",
        author: "Gary Gay"
    },
    {
        text: "The beetle I righted\nflies straight into\na cobweb",
        author: "George Swede"
    },
    {
        text: "leaf in my palm\nits stem extends\nmy lifeline",
        author: "Helen Davie"
    },
    {
        text: "the river—\ncoming to it with nothing\nin my hands",
        author: "Leatrice Lifshitz"
    },
    {
        text: "deep silence\nthe orphaned nestlings\nthis third morning",
        author: "Kay F. Anderson"
    },
    {
        text: "summer solstice—\nthe long tips of lavender\nbent by bees",
        author: "Jeffrey Witkin"
    },
    {
        text: "snowbound\ncoloring inside\nthe lines",
        author: "Sandra Fuhringer"
    },
    {
        text: "winter seclusion\ntending all day\nthe small fire",
        author: "Jim Kacian"
    },
    {
        text: "on the path\nonly one of us\ntouched by a falling leaf",
        author: "Helen K. Davie"
    },
    {
        text: "winter, bedtime\nstatic flickers\nthrough a white sleeve",
        author: "John Stevenson"
    },
    {
        text: "warm river—\nup to our necks\nin sunset",
        author: "Ruth Yarrow"
    },
    {
        text: "beneath the ice\nthe waterfall\nstill falling",
        author: "Jeanne Emrich"
    },
    {
        text: "Old garden chair\nsagging with the weight\nof a single leaf.",
        author: "Alice Mackenzie Swaim"
    },
    {
        text: "City window\nmountains and pines\netched in frost",
        author: "Peggy Heinrich"
    },
    {
        text: "Autumn deepens\nan empty snail shell\nexplored by an ant",
        author: "Garry Gay"
    },
    {
        text: "early morning sun\nscattered on the table\nseveral grains of salt",
        author: "Christopher Herold"
    },
    {
        text: "snowflakes\nno one will miss\nmelt in her hand",
        author: "Gary Hotham"
    },
    {
        text: "bright leaves\nblow through\nher dream house",
        author: "John Stevenson"
    },
    {
        text: "on the river\nof many names, one cloud\nfloating",
        author: "Virginia Brady Young"
    },
    {
        text: "the war memorial—\nmigrating butterflies\ncover the names",
        author: "Penny Harter"
    },
    {
        text: "falling leaves\nthe house comes\nout of the wood",
        author: "Jim Kacian"
    },
    {
        text: "leaving you—\nfog on either side\nof the white heron",
        author: "Leatrice Lifshitz"
    },
    {
        text: "mourning dove calls . . .\nmy elderly neighbor stills\nthe sound of her hoeing",
        author: "James Chessing"
    },
    {
        text: "a white horse\ndrinks from the acequia\nblossoming locust",
        author: "Elizabeth Searle Lamb"
    },
    {
        text: "cloud shadow\nlong enough to close\nthe poppies",
        author: "Christopher Herold"
    },
    {
        text: "The thick clang\nof a cowbell\nthe sun deepens",
        author: "June Moreau"
    },
    {
        text: "Roses\nin the smaller room\nmore fragrant",
        author: "Sydney Bougy"
    },
    {
        text: "up the path\nto touch that one oak\nin last night's dream",
        author: "R. J. Trayhern"
    },
    {
        text: "dry leaves\nthe old archer\ncurves his eyebrow",
        author: "Jim Boyd"
    },
    {
        text: "soft rain—\nthe new grave\nlooks old",
        author: "William Cullen, Jr."
    },
    {
        text: "dusk\na lone car going the same way\nas the river",
        author: "George Swede"
    },
    {
        text: "First days of summer . . .\nalready the leaves gather\nbeneath the sycamores",
        author: "Tom Tico"
    },
    {
        text: "yard sale,\nsunlight filling\nmason jars",
        author: "Jerry Kilbride"
    },
    {
        text: "light\nup under the gull's wing:\nsunrise",
        author: "Ruth M. Yarrow"
    },
    {
        text: "such coolness\nthe snail stretches\nits neck",
        author: "Clark Strand"
    },
    {
        text: "bird song\nlost\nin bird song",
        author: "Peggy Willis Lyles"
    },
    {
        text: "in the sea\nthe fireworks\nrising",
        author: "Rebecca Rust"
    },
    {
        text: "circling each thigh\ncool\nof the night river",
        author: "Ruth M. Yarrow"
    },
    {
        text: "canyon:\nat the very edge\nriversound",
        author: "Ruth Yarrow"
    },
    {
        text: "between the fireflies\nthe changing shape of darkness",
        author: "Robert Kramer"
    },
    {
        text: "mist\nlifting\nthe loon's cry",
        author: "Ruth M. Yarrow"
    },
    {
        text: "hot wind\nthe roadrunner's beak\nopens and closes",
        author: "Margarita Mondrus Engle"
    },
    {
        text: "spring drizzle\nrounding the thorn\na drop of light",
        author: "Ruth M. Yarrow"
    },
    {
        text: "horizon\nwild swan drifting through\nthe woman's body",
        author: "Raymond Roseliep"
    },
    {
        text: "a spider's web\nacross the windharp\nthe silence",
        author: "Elizabeth Searle Lamb"
    },
    {
        text: "horns fold\nat my shadow's touch;\nbrown slug",
        author: "Darold D. Braida"
    },
    {
        text: "the child\npoints at the moon\nand says, \"bird\"",
        author: "James O'Neil"
    },
    {
        text: "one seagull\non a shaft of air;\ndawn",
        author: "Darold D. Braida"
    },
    {
        text: "Lean man\nCarving\nThe tree's dream.",
        author: "Kirsten Stromberg"
    },
    {
        text: "Where the ripple was\nthe fisherman casts his line;\nanother ripple",
        author: "Garry Gay"
    },
    {
        text: "Quiet strokes\nof night swimmer: the slap\nof beaver tails . . .",
        author: "Virginia Brady Young"
    },
    {
        text: "The way of the conch—\nblueing in the sea, and\nechoing in the wind",
        author: "Joyce"
    },
    {
        text: "open water swim—\narms part the silver surface\nbeneath, a deep hush",
        author: "Luke Hollomon"
    },
    {
        text: "fog on the lake—\nonly my breath\nto keep me company",
        author: "Luke Hollomon"
    },
    {
        text: "jellyfish below,\nmoon drifting through the current—\nI keep my rhythm",
        author: "Luke Hollomon"
    },
    {
        text: "chop and current—\neach wave a question\nI answer with stroke",
        author: "Luke Hollomon"
    },
    {
        text: "rock garden ahead—\nmy front wheel choosing paths\nfaster than I think",
        author: "Luke Hollomon"
    },
    {
        text: "brakes sing on descent—\nnot fear, just the joy\nof falling with control",
        author: "Luke Hollomon"
    }
];


function getDailyHaiku() {
    const today = new Date();
    const start = new Date(today.getFullYear(), 0, 0);
    const diff = today - start;
    const oneDay = 1000 * 60 * 60 * 24;
    const dayOfYear = Math.floor(diff / oneDay);
    return haiku[dayOfYear % haiku.length];
}

function displayHaiku() {
    const dailyHaiku = getDailyHaiku();
    document.getElementById('haiku-text').innerText = dailyHaiku.text;
    document.getElementById('author-display').innerText = `- ${dailyHaiku.author}`;
}

// Weather data function


// River data functions
async function fetchRiverData(siteCode, parameterCode, startDate, endDate) {
    // Format dates correctly for USGS API
    const formatDate = (date) => date.toISOString().split('T')[0];
    const formattedStartDate = formatDate(startDate);
    const formattedEndDate = formatDate(endDate);

    const url = `https://waterservices.usgs.gov/nwis/iv/?format=json&sites=${siteCode}&startDT=${formattedStartDate}&endDT=${formattedEndDate}&parameterCd=${parameterCode}&siteStatus=all`;

    try {
        const response = await fetch(url);
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        const data = await response.json();
        
        // Check if we have the expected data structure
        if (data.value && data.value.timeSeries && data.value.timeSeries.length > 0) {
            return data.value.timeSeries[0].values[0].value;
        } else {
            console.error("Unexpected data structure:", data);
            return null;
        }
    } catch (error) {
        console.error("Error fetching river data:", error);
        return null;
    }
}
async function displayRiverInfo() {
    const currentDate = new Date();
    const yesterday = new Date(currentDate);
    yesterday.setDate(yesterday.getDate() - 1);

    const levelData = await fetchRiverData('02037500', '00065', yesterday, currentDate);  // Westham gauge, water level
  console.log(levelData[0].value);
    const tempData = await fetchRiverData('02035000', '00010', yesterday, currentDate);   // Cartersville gauge, water temperature

    const riverInfoElement = document.getElementById('river-info');
    if (tempData && tempData.length > 0) {
        const latestTemp = tempData[tempData.length - 1];
        const tempTime = new Date(latestTemp.dateTime).toLocaleString([], {month: 'numeric', day: 'numeric', hour: '2-digit', minute:'2-digit', hour12: true});
        const tempCelsius = parseFloat(latestTemp.value);
        const tempFahrenheit = (tempCelsius * 9/5) + 32;
        riverInfoElement.innerHTML += `<p>The James is<span id="river-temperature"> ${tempFahrenheit.toFixed(0)}°F</span> and at <span id="river-height">${levelData[0].value}'</span></p>`;
    } else {
        riverInfoElement.innerHTML += '<p class="error-message">Looks like our temperature sensor decided to go for a swim.</p>';
    }
}

// Weather phrases organized by category
const weatherPhrases = {
    hot: [
        "It's fucking hot!",
        "Feels like the surface of the sun out there.",
        "You could fry an egg on the sidewalk.",
        "It's hotter than a jalapeño's armpit!",
        "Time to become one with your air conditioner.",
        "It's a steamy one out there.",
        "It's super hot. Maybe get naked?"
    ],
    warm: [
        "It's pretty warm out there.",
        "Perfect weather for shorts and shades!",
        "Grab a cold drink and enjoy the warmth.",
        "Feels like summer's giving us a big hug.",
        "Warm enough to make you appreciate shade.",
        "Not too hot, but warm indeed.",
        "The sun'll get ya but the weather's not bad."
    ],
    pleasant: [
        "The weather's quite pleasant.",
        "It's a perfect day for a picnic!",
        "Goldilocks would approve - not too hot, not too cold.",
        "Weather so nice, you'll want to bottle it up.",
        "It's pretty much perfect.",
        "Maybe on the cool side, but nice!",
        "A day to enjoy."
    ],
    cool: [
        "It's a bit chilly", 
      "You might want to grab a light jacket.",
        "Perfect weather for a brisk walk",
        "Sweater weather is upon us!",
      "It's a chilly one out there",
      "Grab yourself a jacket.",
      "Maybe nice for running."
    ],
    cold: [
        "Grab a jacket, it's cold!",
        "Brrr! Time to bundle up!",
        "It's nippy enough to make a polar bear shiver.",
        "You might see your breath out there!",
        "It's a cold one, watch out!",
        "Find your gloves and hat."
    ],
    rainy: [
        "It's raining cats and dogs!",
        "Perfect weather for ducks",
        "Time to sing in the rain!",
        "Mother Nature's giving the plants a drink.",
        "Grab your galoshes and embrace the puddles!"
    ],
    snowy: [
        "It's a winter wonderland!",
        "Snowmen are popping up everywhere!",
        "Time to break out the sleds!",
        "The world's getting a fresh coat of paint.",
    ],
    windy: [
        "Hold onto your hats, it's windy!",
        "The trees are doing the cha-cha out there.",
        "Kite flyers, rejoice!",
        "It's blowing harder than a wolf at a pig's house.",
        "Mother Nature's giving us all blow-dries today.",
      "That hair's gonna floof!"
    ]
};

function getRandomPhrase(array) {
    return array[Math.floor(Math.random() * array.length)];
}

function getWeatherPhrase(temp, humidity, weatherCondition) {
    if (weatherCondition.includes('rain')) {
        return getRandomPhrase(weatherPhrases.rainy);
    } else if (weatherCondition.includes('snow')) {
        return getRandomPhrase(weatherPhrases.snowy);
    } else if (weatherCondition.includes('wind') || weatherCondition.includes('gust')) {
        return getRandomPhrase(weatherPhrases.windy);
    }

    if (temp > 90 && humidity > 60) {
        return getRandomPhrase(weatherPhrases.hot) + " And it's humid too!";
    } else if (temp > 90) {
        return getRandomPhrase(weatherPhrases.hot);
    } else if (temp > 80) {
        return getRandomPhrase(weatherPhrases.warm);
    } else if (temp > 60) {
        return getRandomPhrase(weatherPhrases.pleasant);
    } else if (temp > 40) {
        return getRandomPhrase(weatherPhrases.cool);
    } else {
        return getRandomPhrase(weatherPhrases.cold);
    }
}

// Simple function to get and display weather
async function updateWeather() {
        const apiKey = 'e6237d931351eb01d11683806c7a8a81';
const city = 'Richmond,US';
    const url = `https://api.openweathermap.org/data/2.5/weather?lat=37.5407&lon=-77.4360&exclude=minutely,hourly&appid=${apiKey}&units=imperial`;

    try {
        // Fetch weather data
        const response = await fetch(url);
        const data = await response.json();
        console.log("Weather data:", data); // For debugging

        // Get elements
        const weatherDisplay = document.getElementById('current-weather');
        
        // Format the weather data
        const temp = Math.round(data.main.temp);
        const humidity = data.main.humidity;
        const condition = data.weather[0].description.toUpperCase();
        const weatherPhrase = getWeatherPhrase(temp, humidity, condition);
        const iconCode = data.weather[0].icon;
        const description = data.weather[0].description;
        const windSpeed = Math.round(data.wind.speed);
       const windDeg = data.wind.deg;
       const windDirection = getWindDirection(windDeg);
       const utcSunrise = new Date(data.sys.sunrise * 1000);
       const utcSunset = new Date(data.sys.sunset * 1000);
       
       // Use Intl.DateTimeFormat to get time in 'America/New_York' (ET, DST-aware)
       const options = {
         timeZone: 'America/New_York',
         hour: 'numeric',
         minute: '2-digit',
         hour12: true
       };
       
       const sunriseEasternTime = new Intl.DateTimeFormat('en-US', options).format(utcSunrise);
       const sunsetEasternTime = new Intl.DateTimeFormat('en-US', options).format(utcSunset);
        // Update the display
        weatherDisplay.innerHTML = `
            <p id="tempParagraph" style="padding-top: 40px;"><span id="temperature">${temp}°F</span>
            <span>${description}</span><span></span></p>
            <p>Wind is ${windSpeed}mph from the ${windDirection}</p>
            <p>The humidity is ${humidity}%</p>
            <div class="sun-times">
               <div class="sunrise">
                   <span>Sunrise is at</span>
                   <span>${sunriseEasternTime}</span>
               </div>
               <div class="sunset">
                   <span> Sunset is at</span>
                   <span>${sunsetEasternTime}</span>
               </div>
           </div>
        `;

    } catch (error) {
        console.error("Error fetching weather:", error);
        document.getElementById('current-weather').innerHTML = `
            <h2>Current Weather</h2>
            <p class="error-message">Oops! Our weather sensor is on vacation. Check back soon!</p>
        `;
    }
}
function getWindDirection(degrees) {
   const directions = ['N', 'NNE', 'NE', 'ENE', 'E', 'ESE', 'SE', 'SSE',
                      'S', 'SSW', 'SW', 'WSW', 'W', 'WNW', 'NW', 'NNW'];
   const index = Math.round(((degrees % 360) / 22.5));
   return directions[index % 16];
}
// Call this when the page loads
document.addEventListener('DOMContentLoaded', () => {
    updateWeather();
    // Update weather every 5 minutes
    setInterval(updateWeather, 300000);
});
async function updateForecast() {
    const apiKey = 'e6237d931351eb01d11683806c7a8a81';  // Use the same API key
 const lat = 37.5407;
    const lon = -77.4360;
    const url = `https://api.openweathermap.org/data/2.5/forecast?lat=${lat}&lon=${lon}&appid=${apiKey}&units=imperial`;

    try {
        const response = await fetch(url);
        const data = await response.json();
        console.log("Forecast data:", data);

        const forecastDisplay = document.getElementById('forecast');
        
        // Get unique days and track min/max temps
        const dailyForecasts = {};
        
        data.list.forEach(item => {
            const date = new Date(item.dt * 1000).toLocaleDateString();
            const temp = item.main.temp;
            
            if (!dailyForecasts[date]) {
                dailyForecasts[date] = {
                    date: item.dt,
                    minTemp: temp,
                    maxTemp: temp,
                    icon: item.weather[0].icon,
                    description: item.weather[0].description
                };
            } else {
                dailyForecasts[date].minTemp = Math.min(dailyForecasts[date].minTemp, temp);
                dailyForecasts[date].maxTemp = Math.max(dailyForecasts[date].maxTemp, temp);
            }
        });

        // Convert to array and take first 7 days
        const forecasts = Object.values(dailyForecasts).slice(0, 4);

        // Create forecast HTML
        forecastDisplay.innerHTML = '';
        
        const forecastGrid = document.createElement('div');
        forecastGrid.className = 'forecast-grid';

        forecasts.forEach(day => {
            const date = new Date(day.date * 1000);
            const dayName = date.toLocaleDateString('en-US', { weekday: 'short' });
            const highTemp = Math.round(day.maxTemp);
            const lowTemp = Math.round(day.minTemp);

            const dayElement = document.createElement('div');
            dayElement.className = 'forecast-day';
            dayElement.innerHTML = `
                <div class="day-name">${dayName}</div>
                <img src="http://openweathermap.org/img/wn/${day.icon}.png" alt="${day.description}">
                <div class="temp">${highTemp}° / ${lowTemp}°</div>
                <div class="description">${day.description}</div>
            `;
            forecastGrid.appendChild(dayElement);
        });

        forecastDisplay.appendChild(forecastGrid);

    } catch (error) {
        console.error("Error fetching forecast:", error);
        document.getElementById('forecast').innerHTML = `
            <p class="error-message">Our forecast crystal ball needs polishing. Check back soon!</p>
        `;
    }
}

async function fetchRiverData(siteCode, parameterCode, startDate, endDate) {
    const url = `https://waterservices.usgs.gov/nwis/iv/?format=json&sites=${siteCode}&startDT=${startDate.toISOString()}&endDT=${endDate.toISOString()}&parameterCd=${parameterCode}&siteStatus=all`;

    try {
        const response = await fetch(url);
        const data = await response.json();
        return data.value.timeSeries[0].values[0].value;
    } catch (error) {
        console.error("Error fetching river data:", error);
        return null;
    }
}
// Initialize everything
document.addEventListener('DOMContentLoaded', () => {
    console.log('DOM fully loaded');
    displayHaiku();
    displayRiverInfo();
    updateWeather();
    updateForecast();
  setInterval(() => {
        updateWeather();
        updateForecast();
    }, 600000);
});
